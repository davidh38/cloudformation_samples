AWSTemplateFormatVersion: '2010-09-09'
Description: Master template for nested stacks with all resources

Resources:
  NetworkStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub https://s3.amazonaws.com/cf-bucket-123434/${AWS::Region}/network.yml

  CertificateStack:
    Type: AWS::CloudFormation::Stack
    DependsOn: NetworkStack
    Properties:
      TemplateURL: !Sub https://s3.amazonaws.com/cf-bucket-123434/${AWS::Region}/certificate.yml

  LoadBalancerStack:
    Type: AWS::CloudFormation::Stack
    DependsOn: CertificateStack
    Properties:
      TemplateURL: !Sub https://s3.amazonaws.com/cf-bucket-123434/${AWS::Region}/loadbalancer.yml

  ApplicationStack:
    Type: AWS::CloudFormation::Stack
    DependsOn: LoadBalancerStack
    Properties:
      TemplateURL: !Sub https://s3.amazonaws.com/cf-bucket-123434/${AWS::Region}/ec2.yml

  DNSStack:
    Type: AWS::CloudFormation::Stack
    DependsOn: 
      - LoadBalancerStack
      - CertificateStack
    Properties:
      TemplateURL: !Sub https://s3.amazonaws.com/cf-bucket-123434/${AWS::Region}/dns.yml

Outputs:
  DomainEndpoint:
    Description: Domain endpoint for the application
    Value: !GetAtt DNSStack.Outputs.DomainEndpoint
  
  LoadBalancerDNS:
    Description: DNS name of the Application Load Balancer
    Value: !GetAtt LoadBalancerStack.Outputs.LoadBalancerDNS
  
  CertificateArn:
    Description: ARN of the SSL/TLS certificate
    Value: !GetAtt CertificateStack.Outputs.CertificateArn
