#+TITLE: Security Group Ports - EC2 Instance Security Configuration
#+AUTHOR: Infrastructure Team
#+VERSION: 1.0

* NAME
security_group_ports - EC2 instance security group configuration for web and management access

* SYNOPSIS
- Port 443/TCP - Web application HTTPS traffic and EC2 instance management via AWS Systems Manager (SSM)

* DESCRIPTION
The security group configuration manages access to EC2 instances running in a private subnet,
controlling both web traffic and instance management access. The configuration is implemented
through AWS CloudFormation in the ec2.yml template. CloudWatch monitoring is enabled via the
CloudWatch agent installed on EC2 instances with appropriate IAM roles.

* NETWORK TOPOLOGY
#+begin_example
VPC (10.0.0.0/16)
├── Public Subnet
│   └── Application Load Balancer
│       ├── Listens on Port 443 (HTTPS)
│       └── Routes traffic to private instances (Port 80)
│
└── Private Subnet
    ├── EC2 Instances (Auto Scaling Group)
    │   ├── Security Group
    │   │   ├── Inbound Port 80: Web Traffic from ALB
    │   │   └── Inbound Port 443: SSM Access
    │   └── Docker Container (Port 80)
    │
    └── VPC Endpoints
        ├── SSM Endpoint (Port 443)
        └── SSM Messages Endpoint (Port 443)
#+end_example

* TRAFFIC FLOW
Internet → ALB → EC2 Instances

#+begin_example
┌─────────┐     ┌─────┐     ┌──────────────┐
│Internet │ →   │ ALB │ →   │EC2 Instances │
└─────────┘     └─────┘     └──────────────┘
    │             │              │
    └─────────────┘              │
    HTTPS (443) → HTTP (80)      │
                                │
SSM & CloudWatch                 │
┌─────────┐                     │
│AWS SSM  │ → → → → → → → → → →─┤
└─────────┘     HTTPS (443)     │
                                │
┌───────────┐                   │
│CloudWatch │ ← ← ← ← ← ← ← ← ←─┘
└───────────┘    Agent (Logs & Metrics)
#+end_example

* PORTS
** 443/TCP (ALB)
- Purpose: HTTPS web traffic and EC2 instance management
- Source: 0.0.0.0/0
- Target: ALB (HTTPS) and SSM endpoints
- Flow: Internet → ALB (HTTPS:443) → EC2 Instance (HTTP:80)
- Flow: AWS SSM → VPC Endpoint → EC2 Instance

** 80/TCP (Internal)
- Purpose: Web application traffic from ALB
- Source: ALB Security Group
- Target: Docker container running web application
- Flow: ALB → EC2 Instance → Docker Container

* SECURITY CONSIDERATIONS
** Network Isolation
- EC2 instances are placed in private subnets
- No direct internet access to instances
- Web traffic must flow through ALB

** Access Control
- Web traffic (80/TCP) is controlled via ALB
- Management access (443/TCP) is restricted to SSM
- Instance security group acts as instance-level firewall

** Management
- SSM provides secure instance management without SSH
- VPC endpoints ensure private SSM communication
- Auto Scaling Group manages instance lifecycle
- CloudWatch agent provides monitoring and logging capabilities

** Monitoring
- CloudWatch agent installed and configured on instances
- IAM roles grant necessary CloudWatch permissions
- Performance metrics and logs collection enabled
- Docker container logs forwarded to CloudWatch

* SEE ALSO
ec2.yml(5), vpc(7), alb(7), ssm(7), cloudwatch(7)
